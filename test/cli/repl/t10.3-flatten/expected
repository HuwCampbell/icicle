welcome to iREPL
ok, loaded 20 functions from data/libs/prelude.icicle
ok, loaded test/cli/repl/data.psv, 13 rows
> -- Show everything
> ok, core-simp is now on
ok, flatten is now on
> > -- A rather complicated feature to convert to Avalanche
> - Flattened:
gen$date = DATE
{
  init acc$c$conv$13$simp$4@{Bool} = True@{Bool};
  init acc$c$conv$13$simp$5@{Error} = ExceptTombstone@{Error};
  init acc$c$conv$13$simp$6@{Int} = 0@{Int};
  init acc$conv$30$simp$7@{Buf 3 Bool} = Buf []@{Buf 3 Bool};
  init acc$conv$30$simp$8@{Buf 3 Error} = Buf []@{Buf 3 Error};
  init acc$conv$30$simp$9@{Buf 3 Int} = Buf []@{Buf 3 Int};
  load_resumable@{Bool} acc$c$conv$13$simp$4;
  load_resumable@{Error} acc$c$conv$13$simp$5;
  load_resumable@{Int} acc$c$conv$13$simp$6;
  load_resumable@{Buf 3 Bool} acc$conv$30$simp$7;
  load_resumable@{Buf 3 Error} acc$conv$30$simp$8;
  load_resumable@{Buf 3 Int} acc$conv$30$simp$9;
  for_facts (gen$fact$simp$64@{Bool},
             gen$fact$simp$65@{Error},
             gen$fact$simp$66@{Int},
             gen$fact$simp$67@{DateTime}) in new {
    read@{Buf 3 Bool} acc$conv$30$simp$10 = acc$conv$30$simp$7;
    read@{Buf 3 Error} acc$conv$30$simp$11 = acc$conv$30$simp$8;
    read@{Buf 3 Int} acc$conv$30$simp$12 = acc$conv$30$simp$9;
    write acc$conv$30$simp$7 = Buf_push#@{Buf 3 Bool}
                               acc$conv$30$simp$10
                               gen$fact$simp$64;
    write acc$conv$30$simp$8 = Buf_push#@{Buf 3 Error}
                               acc$conv$30$simp$11
                               gen$fact$simp$65;
    write acc$conv$30$simp$9 = Buf_push#@{Buf 3 Int}
                               acc$conv$30$simp$12
                               gen$fact$simp$66;
    init flat$1$simp$13@{Bool} = False@{Bool};
    init flat$1$simp$15@{Bool} = False@{Bool};
    if (gen$fact$simp$64) {
      write flat$1$simp$13 = True@{Bool};
      write flat$1$simp$15 = gt#@{Int}
                             gen$fact$simp$66 (10@{Int});
    } else {
      write flat$1$simp$13 = False@{Bool};
      write flat$1$simp$15 = False@{Bool};
    }
    read@{Bool} flat$1$simp$16 = flat$1$simp$13;
    read@{Bool} flat$1$simp$18 = flat$1$simp$15;
    init flat$2@{Bool} = False@{Bool};
    if (flat$1$simp$16) {
      write flat$2 = flat$1$simp$18;
    } 
     else {
      write flat$2 = True@{Bool};
    } 
    
    read@{Bool} flat$2 = flat$2;
    if (flat$2) {
      read@{Bool} acc$c$conv$13$simp$19 = acc$c$conv$13$simp$4;
      read@{Error} acc$c$conv$13$simp$20 = acc$c$conv$13$simp$5;
      read@{Int} acc$c$conv$13$simp$21 = acc$c$conv$13$simp$6;
      init flat$3$simp$22@{Bool} = False@{Bool};
      init flat$3$simp$23@{Error} = ExceptTombstone@{Error};
      init flat$3$simp$24@{Int} = 0@{Int};
      if (gen$fact$simp$64) {
        init flat$6$simp$25@{Bool} = False@{Bool};
        init flat$6$simp$26@{Error} = ExceptTombstone@{Error};
        init flat$6$simp$27@{Int} = 0@{Int};
        if (acc$c$conv$13$simp$19) {
          write flat$6$simp$25 = True@{Bool};
          write flat$6$simp$26 = ExceptTombstone@{Error};
          write flat$6$simp$27 = add#@{Int}
                                 acc$c$conv$13$simp$21 (1@{Int});
        } else {
          write flat$6$simp$25 = False@{Bool};
          write flat$6$simp$26 = acc$c$conv$13$simp$20;
          write flat$6$simp$27 = 0@{Int};
        }
        read@{Bool} flat$6$simp$28 = flat$6$simp$25;
        read@{Error} flat$6$simp$29 = flat$6$simp$26;
        read@{Int} flat$6$simp$30 = flat$6$simp$27;
        init flat$7$simp$31@{Bool} = False@{Bool};
        init flat$7$simp$32@{Error} = ExceptTombstone@{Error};
        init flat$7$simp$33@{Int} = 0@{Int};
        if (flat$6$simp$28) {
          write flat$7$simp$31 = True@{Bool};
          write flat$7$simp$32 = ExceptTombstone@{Error};
          write flat$7$simp$33 = flat$6$simp$30;
        } else {
          write flat$7$simp$31 = False@{Bool};
          write flat$7$simp$32 = flat$6$simp$29;
          write flat$7$simp$33 = 0@{Int};
        }
        read@{Bool} flat$7$simp$34 = flat$7$simp$31;
        read@{Error} flat$7$simp$35 = flat$7$simp$32;
        read@{Int} flat$7$simp$36 = flat$7$simp$33;
        write flat$3$simp$22 = flat$7$simp$34;
        write flat$3$simp$23 = flat$7$simp$35;
        write flat$3$simp$24 = flat$7$simp$36;
      } else {
        write flat$3$simp$22 = False@{Bool};
        write flat$3$simp$23 = gen$fact$simp$65;
        write flat$3$simp$24 = 0@{Int};
      }
      read@{Bool} flat$3$simp$37 = flat$3$simp$22;
      read@{Error} flat$3$simp$38 = flat$3$simp$23;
      read@{Int} flat$3$simp$39 = flat$3$simp$24;
      write acc$c$conv$13$simp$4 = flat$3$simp$37;
      write acc$c$conv$13$simp$5 = flat$3$simp$38;
      write acc$c$conv$13$simp$6 = flat$3$simp$39;
    }
  }
  save_resumable@{Bool} acc$c$conv$13$simp$4;
  save_resumable@{Error} acc$c$conv$13$simp$5;
  save_resumable@{Int} acc$c$conv$13$simp$6;
  save_resumable@{Buf 3 Bool} acc$conv$30$simp$7;
  save_resumable@{Buf 3 Error} acc$conv$30$simp$8;
  save_resumable@{Buf 3 Int} acc$conv$30$simp$9;
  read@{Bool} c$conv$13$simp$40 = acc$c$conv$13$simp$4;
  read@{Error} c$conv$13$simp$41 = acc$c$conv$13$simp$5;
  read@{Int} c$conv$13$simp$42 = acc$c$conv$13$simp$6;
  read@{Buf 3 Bool} conv$30$simp$43 = acc$conv$30$simp$7;
  read@{Buf 3 Error} conv$30$simp$44 = acc$conv$30$simp$8;
  read@{Buf 3 Int} conv$30$simp$45 = acc$conv$30$simp$9;
  init flat$16$simp$46@{Bool} = False@{Bool};
  init flat$16$simp$47@{Error} = ExceptTombstone@{Error};
  init flat$16$simp$48@{Int} = 0@{Int};
  init flat$16$simp$49@{Array Bool} = []@{Array Bool};
  init flat$16$simp$50@{Array Error} = []@{Array Error};
  init flat$16$simp$51@{Array Int} = []@{Array Int};
  if (c$conv$13$simp$40) {
    write flat$16$simp$46 = True@{Bool};
    write flat$16$simp$47 = ExceptTombstone@{Error};
    write flat$16$simp$48 = c$conv$13$simp$42;
    write flat$16$simp$49 = Buf_read#@{Array Bool}
                            conv$30$simp$43;
    write flat$16$simp$50 = Buf_read#@{Array Error}
                            conv$30$simp$44;
    write flat$16$simp$51 = Buf_read#@{Array Int}
                            conv$30$simp$45;
  } else {
    write flat$16$simp$46 = False@{Bool};
    write flat$16$simp$47 = c$conv$13$simp$41;
    write flat$16$simp$48 = 0@{Int};
    write flat$16$simp$49 = []@{Array Bool};
    write flat$16$simp$50 = []@{Array Error};
    write flat$16$simp$51 = []@{Array Int};
  }
  read@{Bool} flat$16$simp$52 = flat$16$simp$46;
  read@{Error} flat$16$simp$53 = flat$16$simp$47;
  read@{Int} flat$16$simp$54 = flat$16$simp$48;
  read@{Array Bool} flat$16$simp$55 = flat$16$simp$49;
  read@{Array Error} flat$16$simp$56 = flat$16$simp$50;
  read@{Array Int} flat$16$simp$57 = flat$16$simp$51;
  output@{(Sum Error (Int, Array (Sum Error Int)))} repl (flat$16$simp$52@{Bool},
               flat$16$simp$53@{Error},
               flat$16$simp$54@{Int},
               flat$16$simp$55@{Array Bool},
               flat$16$simp$56@{Array Error},
               flat$16$simp$57@{Array Int});
}

- Core evaluation:
[homer, (5,[300,400,500])
,marge, (1,[0,10,20])]

> > -- Something involves the abstract buffer type
> - Flattened:
gen$date = DATE
{
  init acc$conv$2$simp$42@{Array DateTime} = []@{Array DateTime};
  init acc$conv$2$simp$43@{Array (Buf 2 Bool)} = []@{Array (Buf 2 Bool)};
  init acc$conv$2$simp$44@{Array (Buf 2 Error)} = []@{Array (Buf 2 Error)};
  init acc$conv$2$simp$45@{Array (Buf 2 Int)} = []@{Array (Buf 2 Int)};
  init acc$conv$2$simp$46@{Array (Buf 2 DateTime)} = []@{Array (Buf 2 DateTime)};
  load_resumable@{Array DateTime} acc$conv$2$simp$42;
  load_resumable@{Array (Buf 2 Bool)} acc$conv$2$simp$43;
  load_resumable@{Array (Buf 2 Error)} acc$conv$2$simp$44;
  load_resumable@{Array (Buf 2 Int)} acc$conv$2$simp$45;
  load_resumable@{Array (Buf 2 DateTime)} acc$conv$2$simp$46;
  for_facts (gen$fact$simp$161@{Bool},
             gen$fact$simp$162@{Error},
             gen$fact$simp$163@{Int},
             gen$fact$simp$164@{DateTime}) in new {
    read@{Array DateTime} acc$conv$2$simp$47 = acc$conv$2$simp$42;
    read@{Array (Buf 2 Bool)} acc$conv$2$simp$48 = acc$conv$2$simp$43;
    read@{Array (Buf 2 Error)} acc$conv$2$simp$49 = acc$conv$2$simp$44;
    read@{Array (Buf 2 Int)} acc$conv$2$simp$50 = acc$conv$2$simp$45;
    read@{Array (Buf 2 DateTime)} acc$conv$2$simp$51 = acc$conv$2$simp$46;
    let anf$0$simp$150 = Buf_push#@{Buf 2 Bool}
                         (Buf []@{Buf 2 Bool}) gen$fact$simp$161;
    let anf$0$simp$151 = Buf_push#@{Buf 2 Error}
                         (Buf []@{Buf 2 Error}) gen$fact$simp$162;
    let anf$0$simp$152 = Buf_push#@{Buf 2 Int}
                         (Buf []@{Buf 2 Int}) gen$fact$simp$163;
    let anf$0$simp$153 = Buf_push#@{Buf 2 DateTime}
                         (Buf []@{Buf 2 DateTime}) gen$fact$simp$164;
    init flat$1@{Bool} = False@{Bool};
    init flat$2@{Array DateTime} = acc$conv$2$simp$47;
    init flat$3$simp$52@{Array (Buf 2 Bool)} = acc$conv$2$simp$48;
    init flat$3$simp$53@{Array (Buf 2 Error)} = acc$conv$2$simp$49;
    init flat$3$simp$54@{Array (Buf 2 Int)} = acc$conv$2$simp$50;
    init flat$3$simp$55@{Array (Buf 2 DateTime)} = acc$conv$2$simp$51;
    read@{Array DateTime} flat$2 = flat$2;
    let flat$4 = Array_length#@{DateTime}
                 flat$2;
    foreach (flat$5 in 0@{Int}..flat$4) {
      read@{Array DateTime} flat$2 = flat$2;
      read@{Array (Buf 2 Bool)} flat$3$simp$56 = flat$3$simp$52;
      read@{Array (Buf 2 Error)} flat$3$simp$57 = flat$3$simp$53;
      read@{Array (Buf 2 Int)} flat$3$simp$58 = flat$3$simp$54;
      read@{Array (Buf 2 DateTime)} flat$3$simp$59 = flat$3$simp$55;
      let simp$1 = unsafe_Array_index#@{DateTime}
                   flat$2 flat$5;
      if (eq#@{DateTime} simp$1
          gen$fact$simp$164) {
        let simp$227 = unsafe_Array_index#@{Buf 2 Bool}
                       flat$3$simp$56 flat$5;
        let simp$230 = unsafe_Array_index#@{Buf 2 Error}
                       flat$3$simp$57 flat$5;
        let simp$233 = unsafe_Array_index#@{Buf 2 Int}
                       flat$3$simp$58 flat$5;
        let simp$236 = unsafe_Array_index#@{Buf 2 DateTime}
                       flat$3$simp$59 flat$5;
        let simp$256 = Buf_push#@{Buf 2 Bool}
                       simp$227 gen$fact$simp$161;
        let simp$260 = Buf_push#@{Buf 2 Error}
                       simp$230 gen$fact$simp$162;
        let simp$264 = Buf_push#@{Buf 2 Int}
                       simp$233 gen$fact$simp$163;
        let simp$268 = Buf_push#@{Buf 2 DateTime}
                       simp$236 gen$fact$simp$164;
        write flat$3$simp$52 = Array_put#@{Buf 2 Bool}
                               flat$3$simp$56 flat$5 simp$256;
        write flat$3$simp$53 = Array_put#@{Buf 2 Error}
                               flat$3$simp$57 flat$5 simp$260;
        write flat$3$simp$54 = Array_put#@{Buf 2 Int}
                               flat$3$simp$58 flat$5 simp$264;
        write flat$3$simp$55 = Array_put#@{Buf 2 DateTime}
                               flat$3$simp$59 flat$5 simp$268;
        write flat$1 = True@{Bool};
      }
    }
    read@{Bool} flat$1 = flat$1;
    if (flat$1) {
      
    } else {
      read@{Array DateTime} flat$9 = flat$2;
      let simp$4 = Array_length#@{DateTime}
                   flat$9;
      let simp$5 = add#@{Int} simp$4 (1@{Int});
      init flat$8@{Array DateTime} = unsafe_Array_create#@{DateTime}
                    simp$5;
      foreach (flat$10 in 0@{Int}..Array_length#@{DateTime}
                             flat$9) {
        read@{Array DateTime} flat$8 = flat$8;
        let simp$7 = unsafe_Array_index#@{DateTime}
                     flat$9 flat$10;
        write flat$8 = Array_put#@{DateTime} flat$8
                       flat$10 simp$7;
      }
      read@{Array DateTime} flat$8 = flat$8;
      write flat$8 = Array_put#@{DateTime} flat$8
                     simp$4 gen$fact$simp$164;
      read@{Array DateTime} flat$8 = flat$8;
      write flat$2 = flat$8;
      read@{Array (Buf 2 Bool)} flat$12$simp$60 = flat$3$simp$52;
      read@{Array (Buf 2 Error)} flat$12$simp$61 = flat$3$simp$53;
      read@{Array (Buf 2 Int)} flat$12$simp$62 = flat$3$simp$54;
      read@{Array (Buf 2 DateTime)} flat$12$simp$63 = flat$3$simp$55;
      let simp$288 = Array_length#@{Buf 2 Bool}
                     flat$12$simp$60;
      let simp$289 = add#@{Int} simp$288
                     (1@{Int});
      init flat$11$simp$64@{Array (Buf 2 Bool)} = unsafe_Array_create#@{Buf 2 Bool}
                             simp$289;
      init flat$11$simp$65@{Array (Buf 2 Error)} = unsafe_Array_create#@{Buf 2 Error}
                             simp$289;
      init flat$11$simp$66@{Array (Buf 2 Int)} = unsafe_Array_create#@{Buf 2 Int}
                             simp$289;
      init flat$11$simp$67@{Array (Buf 2 DateTime)} = unsafe_Array_create#@{Buf 2 DateTime}
                             simp$289;
      foreach (flat$13 in 0@{Int}..Array_length#@{Buf 2 Bool}
                             flat$12$simp$60) {
        read@{Array (Buf 2 Bool)} flat$11$simp$68 = flat$11$simp$64;
        read@{Array (Buf 2 Error)} flat$11$simp$69 = flat$11$simp$65;
        read@{Array (Buf 2 Int)} flat$11$simp$70 = flat$11$simp$66;
        read@{Array (Buf 2 DateTime)} flat$11$simp$71 = flat$11$simp$67;
        let simp$711 = unsafe_Array_index#@{Buf 2 Bool}
                       flat$12$simp$60 flat$13;
        write flat$11$simp$64 = Array_put#@{Buf 2 Bool}
                                flat$11$simp$68 flat$13
                                simp$711;
        let simp$733 = unsafe_Array_index#@{Buf 2 Error}
                       flat$12$simp$61 flat$13;
        write flat$11$simp$65 = Array_put#@{Buf 2 Error}
                                flat$11$simp$69 flat$13
                                simp$733;
        let simp$755 = unsafe_Array_index#@{Buf 2 Int}
                       flat$12$simp$62 flat$13;
        write flat$11$simp$66 = Array_put#@{Buf 2 Int}
                                flat$11$simp$70 flat$13
                                simp$755;
        let simp$777 = unsafe_Array_index#@{Buf 2 DateTime}
                       flat$12$simp$63 flat$13;
        write flat$11$simp$67 = Array_put#@{Buf 2 DateTime}
                                flat$11$simp$71 flat$13
                                simp$777;
      }
      read@{Array (Buf 2 Bool)} flat$11$simp$72 = flat$11$simp$64;
      read@{Array (Buf 2 Error)} flat$11$simp$73 = flat$11$simp$65;
      read@{Array (Buf 2 Int)} flat$11$simp$74 = flat$11$simp$66;
      read@{Array (Buf 2 DateTime)} flat$11$simp$75 = flat$11$simp$67;
      write flat$11$simp$64 = Array_put#@{Buf 2 Bool}
                              flat$11$simp$72 simp$288
                              anf$0$simp$150;
      write flat$11$simp$65 = Array_put#@{Buf 2 Error}
                              flat$11$simp$73 simp$288
                              anf$0$simp$151;
      write flat$11$simp$66 = Array_put#@{Buf 2 Int}
                              flat$11$simp$74 simp$288
                              anf$0$simp$152;
      write flat$11$simp$67 = Array_put#@{Buf 2 DateTime}
                              flat$11$simp$75 simp$288
                              anf$0$simp$153;
      read@{Array (Buf 2 Bool)} flat$11$simp$76 = flat$11$simp$64;
      read@{Array (Buf 2 Error)} flat$11$simp$77 = flat$11$simp$65;
      read@{Array (Buf 2 Int)} flat$11$simp$78 = flat$11$simp$66;
      read@{Array (Buf 2 DateTime)} flat$11$simp$79 = flat$11$simp$67;
      write flat$3$simp$52 = flat$11$simp$76;
      write flat$3$simp$53 = flat$11$simp$77;
      write flat$3$simp$54 = flat$11$simp$78;
      write flat$3$simp$55 = flat$11$simp$79;
    }
    read@{Array DateTime} flat$2 = flat$2;
    read@{Array (Buf 2 Bool)} flat$3$simp$80 = flat$3$simp$52;
    read@{Array (Buf 2 Error)} flat$3$simp$81 = flat$3$simp$53;
    read@{Array (Buf 2 Int)} flat$3$simp$82 = flat$3$simp$54;
    read@{Array (Buf 2 DateTime)} flat$3$simp$83 = flat$3$simp$55;
    write acc$conv$2$simp$42 = flat$2;
    write acc$conv$2$simp$43 = flat$3$simp$80;
    write acc$conv$2$simp$44 = flat$3$simp$81;
    write acc$conv$2$simp$45 = flat$3$simp$82;
    write acc$conv$2$simp$46 = flat$3$simp$83;
  }
  save_resumable@{Array DateTime} acc$conv$2$simp$42;
  save_resumable@{Array (Buf 2 Bool)} acc$conv$2$simp$43;
  save_resumable@{Array (Buf 2 Error)} acc$conv$2$simp$44;
  save_resumable@{Array (Buf 2 Int)} acc$conv$2$simp$45;
  save_resumable@{Array (Buf 2 DateTime)} acc$conv$2$simp$46;
  read@{Array DateTime} conv$2$simp$84 = acc$conv$2$simp$42;
  read@{Array (Buf 2 Bool)} conv$2$simp$85 = acc$conv$2$simp$43;
  read@{Array (Buf 2 Error)} conv$2$simp$86 = acc$conv$2$simp$44;
  read@{Array (Buf 2 Int)} conv$2$simp$87 = acc$conv$2$simp$45;
  init flat$20$simp$89@{Bool} = True@{Bool};
  init flat$20$simp$90@{Error} = ExceptTombstone@{Error};
  init flat$20$simp$91@{Array DateTime} = []@{Array DateTime};
  init flat$20$simp$92@{Array Int} = []@{Array Int};
  foreach (flat$21 in 0@{Int}..Array_length#@{DateTime}
                         conv$2$simp$84) {
    read@{Bool} flat$20$simp$93 = flat$20$simp$89;
    read@{Error} flat$20$simp$94 = flat$20$simp$90;
    read@{Array DateTime} flat$20$simp$95 = flat$20$simp$91;
    read@{Array Int} flat$20$simp$96 = flat$20$simp$92;
    let simp$434 = unsafe_Array_index#@{DateTime}
                   conv$2$simp$84 flat$21;
    let simp$436 = unsafe_Array_index#@{Buf 2 Bool}
                   conv$2$simp$85 flat$21;
    let simp$438 = unsafe_Array_index#@{Buf 2 Error}
                   conv$2$simp$86 flat$21;
    let simp$440 = unsafe_Array_index#@{Buf 2 Int}
                   conv$2$simp$87 flat$21;
    init flat$23$simp$97@{Bool} = False@{Bool};
    init flat$23$simp$98@{Error} = ExceptTombstone@{Error};
    init flat$23$simp$99@{Array DateTime} = []@{Array DateTime};
    init flat$23$simp$100@{Array Int} = []@{Array Int};
    if (flat$20$simp$93) {
      let conv$6$simp$154 = Buf_read#@{Array Bool}
                            simp$436;
      let conv$6$simp$155 = Buf_read#@{Array Error}
                            simp$438;
      let conv$6$simp$156 = Buf_read#@{Array Int}
                            simp$440;
      init flat$27$simp$104@{Bool} = True@{Bool};
      init flat$27$simp$105@{Error} = ExceptTombstone@{Error};
      init flat$27$simp$106@{Int} = 0@{Int};
      foreach (flat$44 in 0@{Int}..Array_length#@{Bool}
                             conv$6$simp$154) {
        read@{Bool} flat$27$simp$111 = flat$27$simp$104;
        read@{Error} flat$27$simp$112 = flat$27$simp$105;
        read@{Int} flat$27$simp$113 = flat$27$simp$106;
        let simp$512 = unsafe_Array_index#@{Bool}
                       conv$6$simp$154 flat$44;
        let simp$518 = unsafe_Array_index#@{Int}
                       conv$6$simp$156 flat$44;
        init flat$46$simp$115@{Bool} = False@{Bool};
        init flat$46$simp$116@{Error} = ExceptTombstone@{Error};
        init flat$46$simp$117@{Int} = 0@{Int};
        if (simp$512) {
          init flat$49$simp$118@{Bool} = False@{Bool};
          init flat$49$simp$119@{Error} = ExceptTombstone@{Error};
          init flat$49$simp$120@{Int} = 0@{Int};
          if (flat$27$simp$111) {
            write flat$49$simp$118 = True@{Bool};
            write flat$49$simp$119 = ExceptTombstone@{Error};
            write flat$49$simp$120 = add#@{Int}
                                     simp$518 flat$27$simp$113;
          } else {
            write flat$49$simp$118 = False@{Bool};
            write flat$49$simp$119 = flat$27$simp$112;
            write flat$49$simp$120 = 0@{Int};
          }
          read@{Bool} flat$49$simp$121 = flat$49$simp$118;
          read@{Error} flat$49$simp$122 = flat$49$simp$119;
          read@{Int} flat$49$simp$123 = flat$49$simp$120;
          write flat$46$simp$115 = flat$49$simp$121;
          write flat$46$simp$116 = flat$49$simp$122;
          write flat$46$simp$117 = flat$49$simp$123;
        } else {
          write flat$46$simp$115 = False@{Bool};
          write flat$46$simp$116 = unsafe_Array_index#@{Error}
                                   conv$6$simp$155 flat$44;
          write flat$46$simp$117 = 0@{Int};
        }
        read@{Bool} flat$46$simp$124 = flat$46$simp$115;
        read@{Error} flat$46$simp$125 = flat$46$simp$116;
        read@{Int} flat$46$simp$126 = flat$46$simp$117;
        write flat$27$simp$104 = flat$46$simp$124;
        write flat$27$simp$105 = flat$46$simp$125;
        write flat$27$simp$106 = flat$46$simp$126;
      }
      read@{Bool} flat$27$simp$130 = flat$27$simp$104;
      read@{Error} flat$27$simp$131 = flat$27$simp$105;
      read@{Int} flat$27$simp$132 = flat$27$simp$106;
      init flat$28$simp$134@{Bool} = False@{Bool};
      init flat$28$simp$135@{Error} = ExceptTombstone@{Error};
      init flat$28$simp$136@{Array DateTime} = []@{Array DateTime};
      init flat$28$simp$137@{Array Int} = []@{Array Int};
      if (flat$27$simp$130) {
        init flat$31@{Bool} = False@{Bool};
        init flat$32@{Array DateTime} = flat$20$simp$95;
        init flat$33@{Array Int} = flat$20$simp$96;
        read@{Array DateTime} flat$32 = flat$32;
        let flat$34 = Array_length#@{DateTime}
                      flat$32;
        foreach (flat$35 in 0@{Int}..flat$34) {
          read@{Array DateTime} flat$32 = flat$32;
          read@{Array Int} flat$33 = flat$33;
          let simp$25 = unsafe_Array_index#@{DateTime}
                        flat$32 flat$35;
          if (eq#@{DateTime} simp$25 simp$434) {
            let flat$36 = unsafe_Array_index#@{Int}
                          flat$33 flat$35;
            write flat$33 = Array_put#@{Int}
                            flat$33 flat$35 flat$36;
            write flat$31 = True@{Bool};
          }
        }
        read@{Bool} flat$31 = flat$31;
        if (flat$31) {
          
        } else {
          read@{Array DateTime} flat$38 = flat$32;
          let simp$28 = Array_length#@{DateTime}
                        flat$38;
          let simp$29 = add#@{Int} simp$28 (1@{Int});
          init flat$37@{Array DateTime} = unsafe_Array_create#@{DateTime}
                         simp$29;
          foreach (flat$39 in 0@{Int}..Array_length#@{DateTime}
                                 flat$38) {
            read@{Array DateTime} flat$37 = flat$37;
            let simp$31 = unsafe_Array_index#@{DateTime}
                          flat$38 flat$39;
            write flat$37 = Array_put#@{DateTime}
                            flat$37 flat$39 simp$31;
          }
          read@{Array DateTime} flat$37 = flat$37;
          write flat$37 = Array_put#@{DateTime}
                          flat$37 simp$28 simp$434;
          read@{Array DateTime} flat$37 = flat$37;
          write flat$32 = flat$37;
          read@{Array Int} flat$41 = flat$33;
          let simp$36 = Array_length#@{Int}
                        flat$41;
          let simp$37 = add#@{Int} simp$36 (1@{Int});
          init flat$40@{Array Int} = unsafe_Array_create#@{Int}
                         simp$37;
          foreach (flat$42 in 0@{Int}..Array_length#@{Int}
                                 flat$41) {
            read@{Array Int} flat$40 = flat$40;
            let simp$39 = unsafe_Array_index#@{Int}
                          flat$41 flat$42;
            write flat$40 = Array_put#@{Int}
                            flat$40 flat$42 simp$39;
          }
          read@{Array Int} flat$40 = flat$40;
          write flat$40 = Array_put#@{Int}
                          flat$40 simp$36
                          flat$27$simp$132;
          read@{Array Int} flat$40 = flat$40;
          write flat$33 = flat$40;
        }
        read@{Array DateTime} flat$32 = flat$32;
        read@{Array Int} flat$33 = flat$33;
        write flat$28$simp$134 = True@{Bool};
        write flat$28$simp$135 = ExceptTombstone@{Error};
        write flat$28$simp$136 = flat$32;
        write flat$28$simp$137 = flat$33;
      } else {
        write flat$28$simp$134 = False@{Bool};
        write flat$28$simp$135 = flat$27$simp$131;
        write flat$28$simp$136 = []@{Array DateTime};
        write flat$28$simp$137 = []@{Array Int};
      }
      read@{Bool} flat$28$simp$138 = flat$28$simp$134;
      read@{Error} flat$28$simp$139 = flat$28$simp$135;
      read@{Array DateTime} flat$28$simp$140 = flat$28$simp$136;
      read@{Array Int} flat$28$simp$141 = flat$28$simp$137;
      write flat$23$simp$97 = flat$28$simp$138;
      write flat$23$simp$98 = flat$28$simp$139;
      write flat$23$simp$99 = flat$28$simp$140;
      write flat$23$simp$100 = flat$28$simp$141;
    } else {
      write flat$23$simp$97 = False@{Bool};
      write flat$23$simp$98 = flat$20$simp$94;
      write flat$23$simp$99 = []@{Array DateTime};
      write flat$23$simp$100 = []@{Array Int};
    }
    read@{Bool} flat$23$simp$142 = flat$23$simp$97;
    read@{Error} flat$23$simp$143 = flat$23$simp$98;
    read@{Array DateTime} flat$23$simp$144 = flat$23$simp$99;
    read@{Array Int} flat$23$simp$145 = flat$23$simp$100;
    write flat$20$simp$89 = flat$23$simp$142;
    write flat$20$simp$90 = flat$23$simp$143;
    write flat$20$simp$91 = flat$23$simp$144;
    write flat$20$simp$92 = flat$23$simp$145;
  }
  read@{Bool} flat$20$simp$146 = flat$20$simp$89;
  read@{Error} flat$20$simp$147 = flat$20$simp$90;
  read@{Array DateTime} flat$20$simp$148 = flat$20$simp$91;
  read@{Array Int} flat$20$simp$149 = flat$20$simp$92;
  output@{(Sum Error (Map DateTime Int))} repl (flat$20$simp$146@{Bool},
               flat$20$simp$147@{Error},
               flat$20$simp$148@{Array DateTime},
               flat$20$simp$149@{Array Int});
}

- Core evaluation:
[homer, [(1989-12-17,100)
        ,(1990-01-01,200)
        ,(1994-01-01,300)
        ,(1999-01-01,400)
        ,(2010-01-01,500)]
,marge, [(1989-12-17,30)]]

> > > 